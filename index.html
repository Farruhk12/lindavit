<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Lindavit –ö–∞–±–∏–Ω–µ—Ç</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 600px; margin: auto; }
    button, input { margin-top: 10px; display: block; width: 100%; padding: 8px; }
    .product { margin: 5px 5px 0 0; display: inline-block; }
    .entry { margin-top: 20px; background: #f9f9f9; padding: 10px; border-radius: 8px; }
  </style>
</head>
<body>
  <h2>üìã –ö–∞–±–∏–Ω–µ—Ç –ø—Ä–æ–≤–∏–∑–æ—Ä–∞ Lindavit</h2>

  <input id="name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∞–ø—Ç–µ–∫–∏" />
  <input id="fio" placeholder="–§–ò–û –ø—Ä–æ–≤–∏–∑–æ—Ä–∞" />
  <input id="number" placeholder="–ù–æ–º–µ—Ä –ø—Ä–æ–≤–∏–∑–æ—Ä–∞" />

  <h3>–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–¥—É–∫—Ç—ã:</h3>
  <div id="products">–ó–∞–≥—Ä—É–∑–∫–∞...</div>

  <button onclick="submitReport()">üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á–µ—Ç</button>
  <button onclick="copyReport()">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫</button>

  <div id="last" class="entry" style="display:none;"></div>

  <script>
    const selected = {};
    const productsDiv = document.getElementById("products");
    const googleCSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRAQ2pv78-mQMhNPHQxv4hS7L8_NZ5j-sWZZMAbdy4gjRrtAWwU31nm0-zTrPWqrbwctnDGtwfGXqQ3/pub?output=csv";

    fetch(googleCSV)
      .then(res => res.text())
      .then(csv => {
        const lines = csv.trim().split(\"\\n\").slice(1); // –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
        productsDiv.innerHTML = \"\";

        lines.forEach(row => {
          const name = row.split(\",\")[0].trim();
          if (name) {
            const btn = document.createElement(\"button\");
            btn.textContent = name;
            btn.className = \"product\";
            btn.onclick = () => {
              selected[name] = (selected[name] || 0) + 1;
              btn.textContent = `${name} (${selected[name]})`;
            };
            productsDiv.appendChild(btn);
          }
        });
      })
      .catch(() => {
        productsDiv.textContent = \"‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç—ã.\";
      });

    function submitReport() {
      const name = document.getElementById(\"name\").value;
      const fio = document.getElementById(\"fio\").value;
      const number = document.getElementById(\"number\").value;

      if (!name || !fio || !number || Object.keys(selected).length === 0) {
        alert(\"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø—Ä–æ–¥—É–∫—Ç.\");
        return;
      }

      const products = Object.entries(selected).map(([product, qty]) => ({ product, qty }));
      fetch(\"https://script.google.com/macros/s/AKfycbyDnSjHHMoFgjfJ4wQc66E8ru9HzGvqqoYuNgncLhOhV8rwYr65shRdHmg-5XApVMoSlg/exec\", {
        method: \"POST\",
        mode: \"no-cors\",
        headers: { \"Content-Type\": \"application/json\" },
        body: JSON.stringify({ name, fio, number, products })
      });

      document.getElementById(\"last\").style.display = \"block\";
      document.getElementById(\"last\").innerHTML = `<strong>${fio}</strong> –æ—Ç–ø—Ä–∞–≤–∏–ª –æ—Ç—á–µ—Ç:<br>` +
        products.map(p => `${p.product} ‚Äî ${p.qty} —à—Ç.`).join(\"<br>\");
    }

    function copyReport() {
      const report = Object.entries(selected)
        .map(([product, qty]) => `${product} ‚Äî ${qty} —à—Ç.`)
        .join(\"\\n\");
      if (!report) {
        alert(\"–°–ø–∏—Å–æ–∫ –ø—É—Å—Ç.\");
        return;
      }
      navigator.clipboard.writeText(report).then(() => {
        alert(\"‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!\");
      }).catch(() => alert(\"‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å.\"));
    }
  </script>
</body>
</html>
